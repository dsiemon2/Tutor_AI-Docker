<%- include('../layouts/principal', { body: `
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <a href="${typeof basePath !== 'undefined' ? basePath : ''}/principal/teachers" class="text-muted text-decoration-none mb-2 d-inline-block">
      <i class="bi bi-arrow-left me-1"></i>Back to Teachers
    </a>
    <h4 class="mb-0">${teacher.firstName} ${teacher.lastName}</h4>
  </div>
  <span class="badge bg-${teacher.role === 'DEPARTMENT_HEAD' ? 'info' : 'primary'} fs-6">${teacher.role}</span>
</div>

<div class="row g-4">
  <!-- Teacher Info -->
  <div class="col-lg-4">
    <div class="card h-100">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-person me-2"></i>Teacher Information</h5>
      </div>
      <div class="card-body">
        <table class="table table-sm">
          <tr>
            <td class="text-muted">Email</td>
            <td class="text-end">${teacher.email}</td>
          </tr>
          <tr>
            <td class="text-muted">Role</td>
            <td class="text-end"><span class="badge bg-${teacher.role === 'DEPARTMENT_HEAD' ? 'info' : 'primary'}">${teacher.role}</span></td>
          </tr>
          <tr>
            <td class="text-muted">Classes</td>
            <td class="text-end">${teacher.classesAsTeacher?.length || 0}</td>
          </tr>
          <tr>
            <td class="text-muted">Total Students</td>
            <td class="text-end">${teacher.classesAsTeacher?.reduce((sum, tc) => sum + (tc.class?.students?.length || 0), 0) || 0}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <!-- Classes -->
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-journal-bookmark me-2"></i>Classes (${teacher.classesAsTeacher?.length || 0})</h5>
      </div>
      <div class="card-body p-0">
        <div class="list-group list-group-flush">
          ${teacher.classesAsTeacher && teacher.classesAsTeacher.length > 0 ? teacher.classesAsTeacher.map(tc =>
            '<div class="list-group-item">' +
              '<div class="d-flex justify-content-between align-items-center">' +
                '<div>' +
                  '<strong>' + tc.class.name + '</strong><br>' +
                  '<small class="text-muted">' + (tc.class.subject?.name || 'No Subject') + '</small>' +
                '</div>' +
                '<div class="text-end">' +
                  '<span class="badge bg-secondary">' + (tc.class.students?.length || 0) + ' students</span><br>' +
                  '<a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/principal/classes/' + tc.class.id + '" class="btn btn-sm btn-link">View Class</a>' +
                '</div>' +
              '</div>' +
            '</div>'
          ).join('') : '<div class="p-4 text-center text-muted"><i class="bi bi-inbox fs-1 d-block mb-2"></i>No classes assigned</div>'}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Students in Teacher's Classes -->
<div class="card mt-4">
  <div class="card-header">
    <h5 class="mb-0"><i class="bi bi-people me-2"></i>Students in Classes</h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="bg-light">
          <tr>
            <th>Student Name</th>
            <th>Email</th>
            <th>Grade Level</th>
            <th>Class</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${teacher.classesAsTeacher && teacher.classesAsTeacher.some(tc => tc.class?.students?.length > 0) ?
            teacher.classesAsTeacher.flatMap(tc =>
              (tc.class?.students || []).map(cs =>
                '<tr>' +
                  '<td><strong>' + cs.student.firstName + ' ' + cs.student.lastName + '</strong></td>' +
                  '<td>' + cs.student.email + '</td>' +
                  '<td>' + (cs.student.gradeLevel !== null ? 'Grade ' + cs.student.gradeLevel : 'N/A') + '</td>' +
                  '<td>' + tc.class.name + '</td>' +
                  '<td><a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/principal/students/' + cs.student.id + '" class="btn btn-sm btn-outline-primary"><i class="bi bi-eye me-1"></i>View</a></td>' +
                '</tr>'
              )
            ).join('') : '<tr><td colspan="5" class="text-center text-muted py-4"><i class="bi bi-inbox fs-1 d-block mb-2"></i>No students in classes</td></tr>'}
        </tbody>
      </table>
    </div>
  </div>
</div>
`, activePage: 'teachers', pageTitle: teacher.firstName + ' ' + teacher.lastName }) %>
