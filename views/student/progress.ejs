<%- include('../layouts/student', { body: `
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h4 class="mb-1">My Progress</h4>
    <p class="text-muted mb-0">Track your learning journey across all subjects</p>
  </div>
</div>

<!-- Progress Overview -->
<div class="row g-4 mb-4">
  <div class="col-md-4">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Topics Studied</div>
          <div class="stat-value">${progress?.length || 0}</div>
        </div>
        <div class="stat-icon bg-primary bg-opacity-10 text-primary">
          <i class="bi bi-book"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Average Mastery</div>
          <div class="stat-value">${progress?.length > 0 ? Math.round(progress.reduce((acc, p) => acc + p.masteryLevel, 0) / progress.length) : 0}<small class="text-muted">%</small></div>
        </div>
        <div class="stat-icon bg-success bg-opacity-10 text-success">
          <i class="bi bi-graph-up"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Subjects</div>
          <div class="stat-value">${Object.keys(progressBySubject || {}).length}</div>
        </div>
        <div class="stat-icon bg-info bg-opacity-10 text-info">
          <i class="bi bi-collection"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Progress by Subject -->
${Object.keys(progressBySubject || {}).length > 0 ? Object.entries(progressBySubject).map(([subjectName, items]) => '<div class="card mb-4"><div class="card-header"><h5 class="mb-0"><i class="bi bi-book me-2"></i>' + subjectName + '</h5></div><div class="card-body"><div class="row g-3">' + items.map(p => '<div class="col-md-6"><div class="d-flex align-items-center gap-3 p-3 bg-light rounded"><div class="flex-grow-1"><div class="d-flex justify-content-between align-items-center mb-1"><span>' + p.topic.name + '</span><span class="badge bg-' + (p.masteryLevel >= 80 ? 'success' : p.masteryLevel >= 50 ? 'primary' : 'warning') + '">' + p.masteryLevel + '%</span></div><div class="progress" style="height: 8px;"><div class="progress-bar bg-' + (p.masteryLevel >= 80 ? 'success' : p.masteryLevel >= 50 ? 'primary' : 'warning') + '" style="width: ' + p.masteryLevel + '%"></div></div><small class="text-muted mt-1 d-block">Last studied: ' + new Date(p.lastActivityAt).toLocaleDateString() + '</small></div></div></div>').join('') + '</div></div></div>').join('') : '<div class="card"><div class="card-body text-center py-5"><i class="bi bi-graph-up fs-1 text-muted d-block mb-3"></i><h5>No Progress Yet</h5><p class="text-muted">Start learning to track your progress across subjects!</p><a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/student/tutor" class="btn btn-primary"><i class="bi bi-play-fill me-2"></i>Start Learning</a></div></div>'}
`, activePage: 'progress', pageTitle: 'My Progress' }) %>
