<%- include('../layouts/student', { body: `
<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-4">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="${typeof basePath !== 'undefined' ? basePath : ''}/student/subjects">Subjects</a></li>
    <li class="breadcrumb-item"><a href="${typeof basePath !== 'undefined' ? basePath : ''}/student/subjects/${topic.subject?.category?.code || ''}">${topic.subject?.category?.name || 'Category'}</a></li>
    <li class="breadcrumb-item active">${topic.name}</li>
  </ol>
</nav>

<!-- Topic Header -->
<div class="card mb-4">
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col">
        <h3 class="mb-2">${topic.name}</h3>
        <p class="text-muted mb-0">
          <strong>Subject:</strong> ${topic.subject?.name || 'N/A'}
          ${topic.gradeLevel !== null ? ' | <strong>Grade Level:</strong> ' + (topic.gradeLevel === 0 ? 'Kindergarten' : 'Grade ' + topic.gradeLevel) : ''}
        </p>
        ${topic.description ? '<p class="mt-2 mb-0">' + topic.description + '</p>' : ''}
      </div>
      <div class="col-auto">
        <a href="${typeof basePath !== 'undefined' ? basePath : ''}/student/tutor?topicId=${topic.id}" class="btn btn-primary btn-lg">
          <i class="bi bi-chat-dots me-2"></i>Ask Tutor
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Lessons -->
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header bg-white">
        <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Lessons</h5>
      </div>
      ${lessons && lessons.length > 0 ? '<div class="list-group list-group-flush">' + lessons.map((lesson, i) => '<a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/student/lessons/' + lesson.id + '" class="list-group-item list-group-item-action"><div class="d-flex justify-content-between align-items-center"><div><div class="d-flex align-items-center gap-3"><span class="badge bg-primary rounded-pill">' + (i + 1) + '</span><div><strong>' + lesson.title + '</strong><br><small class="text-muted">' + (lesson.description || 'No description') + '</small></div></div></div><div class="text-end">' + (lesson.duration ? '<span class="badge bg-light text-dark"><i class="bi bi-clock me-1"></i>' + lesson.duration + ' min</span>' : '') + '<i class="bi bi-chevron-right text-muted ms-2"></i></div></div></a>').join('') + '</div>' : '<div class="card-body text-center py-5 text-muted"><i class="bi bi-journal-x fs-1 d-block mb-3"></i><p class="mb-0">No lessons available for this topic yet.</p><small>Your teacher may add lessons soon, or you can ask the AI tutor directly.</small></div>'}
    </div>

    <!-- Related Assignments -->
    ${assignments && assignments.length > 0 ? '<div class="card mt-4"><div class="card-header bg-white"><h5 class="mb-0"><i class="bi bi-clipboard-check me-2"></i>Related Assignments</h5></div><div class="list-group list-group-flush">' + assignments.map(a => '<a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/student/assignments/' + a.id + '" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"><div><strong>' + a.title + '</strong><br><small class="text-muted">' + a.type + ' | ' + a.maxPoints + ' pts</small></div><div>' + (a.dueDate ? '<small class="text-muted">Due: ' + new Date(a.dueDate).toLocaleDateString() + '</small>' : '') + '</div></a>').join('') + '</div></div>' : ''}

    <!-- Related Quizzes -->
    ${quizzes && quizzes.length > 0 ? '<div class="card mt-4"><div class="card-header bg-white"><h5 class="mb-0"><i class="bi bi-question-circle me-2"></i>Related Quizzes</h5></div><div class="list-group list-group-flush">' + quizzes.map(q => '<a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/student/quizzes/' + q.id + '" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"><div><strong>' + q.title + '</strong><br><small class="text-muted">' + (q.questions?.length || 0) + ' questions | ' + q.passingScore + '% to pass</small></div><div><span class="badge bg-primary">Take Quiz</span></div></a>').join('') + '</div></div>' : ''}
  </div>

  <!-- Sidebar -->
  <div class="col-lg-4">
    <!-- Quick Actions -->
    <div class="card mb-4">
      <div class="card-header bg-white">
        <h6 class="mb-0"><i class="bi bi-lightning me-2"></i>Quick Actions</h6>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <a href="${typeof basePath !== 'undefined' ? basePath : ''}/student/tutor?topicId=${topic.id}" class="btn btn-primary">
            <i class="bi bi-chat-dots me-2"></i>Ask AI Tutor
          </a>
          ${lessons && lessons.length > 0 ? '<a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/student/lessons/' + lessons[0].id + '" class="btn btn-outline-primary"><i class="bi bi-book me-2"></i>Start First Lesson</a>' : ''}
        </div>
      </div>
    </div>

    <!-- My Progress -->
    ${progress ? '<div class="card"><div class="card-header bg-white"><h6 class="mb-0"><i class="bi bi-graph-up me-2"></i>My Progress</h6></div><div class="card-body text-center"><div class="mb-3"><div class="display-4 fw-bold text-primary">' + progress.masteryLevel + '%</div><small class="text-muted">Mastery Level</small></div><div class="progress mb-3" style="height: 10px;"><div class="progress-bar bg-primary" style="width: ' + progress.masteryLevel + '%"></div></div><div class="row text-center"><div class="col-6"><div class="fw-bold">' + (progress.questionsCorrect || 0) + '</div><small class="text-muted">Correct</small></div><div class="col-6"><div class="fw-bold">' + (progress.questionsAttempted || 0) + '</div><small class="text-muted">Attempted</small></div></div></div></div>' : '<div class="card"><div class="card-header bg-white"><h6 class="mb-0"><i class="bi bi-graph-up me-2"></i>My Progress</h6></div><div class="card-body text-center text-muted py-4"><i class="bi bi-bar-chart fs-1 d-block mb-2"></i><p class="mb-0">No progress yet</p><small>Complete lessons and quizzes to track your progress</small></div></div>'}
  </div>
</div>
`, activePage: 'subjects', pageTitle: topic.name, branding, user }) %>
