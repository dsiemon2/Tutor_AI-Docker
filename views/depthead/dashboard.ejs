<%- include('../layouts/depthead', { body: `
<!-- Department Info -->
${department ? '<div class="alert alert-warning mb-4"><i class="bi bi-diagram-3 me-2"></i><strong>' + department.name + '</strong> - Department Administration Portal</div>' : category ? '<div class="alert alert-warning mb-4"><i class="bi bi-diagram-3 me-2"></i><strong>' + category.name + ' Department</strong></div>' : '<div class="alert alert-info mb-4"><i class="bi bi-info-circle me-2"></i>No department assigned. Contact your administrator.</div>'}

<!-- Stats Cards -->
<div class="row g-4 mb-4">
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Teachers in Dept</div>
          <div class="stat-value">${stats?.totalTeachers || 0}</div>
        </div>
        <div class="stat-icon bg-warning bg-opacity-10 text-warning">
          <i class="bi bi-person-workspace"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Subjects</div>
          <div class="stat-value">${stats?.totalSubjects || 0}</div>
        </div>
        <div class="stat-icon bg-primary bg-opacity-10 text-primary">
          <i class="bi bi-book"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Total Lessons</div>
          <div class="stat-value">${stats?.totalLessons || 0}</div>
        </div>
        <div class="stat-icon bg-success bg-opacity-10 text-success">
          <i class="bi bi-journal-bookmark"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3 col-sm-6">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Student Sessions</div>
          <div class="stat-value">${stats?.totalSessions || 0}</div>
        </div>
        <div class="stat-icon bg-info bg-opacity-10 text-info">
          <i class="bi bi-chat-dots"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Subjects List -->
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="bi bi-book me-2"></i>Department Subjects</h5>
        <a href="${typeof basePath !== 'undefined' ? basePath : ''}/depthead/subjects" class="btn btn-sm btn-outline-warning">View All</a>
      </div>
      <div class="card-body p-0">
        <div class="list-group list-group-flush">
          ${subjects && subjects.length > 0 ? subjects.slice(0, 6).map(s => '<div class="list-group-item"><div class="d-flex justify-content-between align-items-center"><div><strong>' + s.name + '</strong><br><small class="text-muted">' + (s.gradeRange || 'All Grades') + '</small></div><div class="text-end"><span class="badge bg-secondary">' + s.topics.length + ' topics</span><br><small class="text-muted">' + s.classes.length + ' classes</small></div></div></div>').join('') : '<div class="p-4 text-center text-muted"><i class="bi bi-inbox fs-1 d-block mb-2"></i>No subjects in department</div>'}
        </div>
      </div>
    </div>
  </div>

  <!-- Teachers List -->
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="bi bi-person-workspace me-2"></i>Department Teachers</h5>
        <a href="${typeof basePath !== 'undefined' ? basePath : ''}/depthead/teachers" class="btn btn-sm btn-outline-warning">View All</a>
      </div>
      <div class="card-body p-0">
        <div class="list-group list-group-flush">
          ${teachers && teachers.length > 0 ? teachers.slice(0, 6).map(t => {
            const classCount = t.classesAsTeacher ? t.classesAsTeacher.length : 0;
            const studentCount = t.classesAsTeacher ? t.classesAsTeacher.reduce((sum, ct) => sum + (ct.class.students ? ct.class.students.length : 0), 0) : 0;
            return '<div class="list-group-item"><div class="d-flex justify-content-between align-items-center"><div><strong>' + t.firstName + ' ' + t.lastName + '</strong><br><small class="text-muted">' + t.email + '</small></div><div class="text-end"><span class="badge bg-warning text-dark">' + classCount + ' classes</span><br><small class="text-muted">' + studentCount + ' students</small></div></div></div>';
          }).join('') : '<div class="p-4 text-center text-muted"><i class="bi bi-inbox fs-1 d-block mb-2"></i>No teachers in department</div>'}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Recent Sessions -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Recent Tutoring Sessions</h5>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Student</th>
                <th>Subject</th>
                <th>Topic</th>
                <th>Grade</th>
                <th>Date</th>
                <th>Duration</th>
              </tr>
            </thead>
            <tbody>
              ${recentSessions && recentSessions.length > 0 ? recentSessions.map(session => '<tr><td><strong>' + (session.student?.firstName || 'Unknown') + ' ' + (session.student?.lastName || '') + '</strong></td><td>' + (session.subject?.name || 'General') + '</td><td>' + (session.topic?.name || '-') + '</td><td>' + (session.student?.gradeLevel !== null && session.student?.gradeLevel !== undefined ? (session.student.gradeLevel === 0 ? 'K' : session.student.gradeLevel < 0 ? 'Pre-K' : session.student.gradeLevel) : '-') + '</td><td>' + new Date(session.startedAt).toLocaleDateString() + '</td><td>' + (session.duration ? Math.round(session.duration / 60) + ' min' : '-') + '</td></tr>').join('') : '<tr><td colspan="6" class="text-center text-muted py-4"><i class="bi bi-inbox fs-1 d-block mb-2"></i>No recent sessions</td></tr>'}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-lightning me-2"></i>Quick Actions</h5>
      </div>
      <div class="card-body">
        <div class="d-flex gap-3 flex-wrap">
          <a href="${typeof basePath !== 'undefined' ? basePath : ''}/depthead/teachers" class="btn btn-outline-warning">
            <i class="bi bi-person-workspace me-2"></i>View Teachers
          </a>
          <a href="${typeof basePath !== 'undefined' ? basePath : ''}/depthead/curriculum" class="btn btn-outline-warning">
            <i class="bi bi-journal-bookmark me-2"></i>Review Curriculum
          </a>
          <a href="${typeof basePath !== 'undefined' ? basePath : ''}/depthead/students" class="btn btn-outline-warning">
            <i class="bi bi-mortarboard me-2"></i>View Students
          </a>
          <a href="${typeof basePath !== 'undefined' ? basePath : ''}/depthead/analytics" class="btn btn-outline-warning">
            <i class="bi bi-graph-up me-2"></i>View Analytics
          </a>
          <a href="${typeof basePath !== 'undefined' ? basePath : ''}/teacher" class="btn btn-outline-primary">
            <i class="bi bi-easel me-2"></i>Teacher Portal
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
`, activePage: 'dashboard', pageTitle: 'Department Head Dashboard' }) %>
