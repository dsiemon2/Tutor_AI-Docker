<%- include('../layouts/depthead', { body: `
<!-- Department Info -->
${category ? '<div class="alert alert-warning mb-4"><i class="bi bi-diagram-3 me-2"></i><strong>' + category.name + ' Department</strong> - Curriculum</div>' : ''}

<!-- Curriculum Stats -->
<div class="row g-4 mb-4">
  <div class="col-md-4">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Total Lessons</div>
          <div class="stat-value">${stats?.totalLessons || 0}</div>
        </div>
        <div class="stat-icon bg-success bg-opacity-10 text-success">
          <i class="bi bi-file-earmark-text"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Total Assignments</div>
          <div class="stat-value">${stats?.totalAssignments || 0}</div>
        </div>
        <div class="stat-icon bg-primary bg-opacity-10 text-primary">
          <i class="bi bi-clipboard-check"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Total Quizzes</div>
          <div class="stat-value">${stats?.totalQuizzes || 0}</div>
        </div>
        <div class="stat-icon bg-warning bg-opacity-10 text-warning">
          <i class="bi bi-question-circle"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Curriculum by Subject -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0"><i class="bi bi-journal-bookmark me-2"></i>Curriculum by Subject</h5>
  </div>
  <div class="card-body p-0">
    ${subjects && subjects.length > 0 ? '<div class="accordion accordion-flush" id="curriculumAccordion">' + subjects.map((s, idx) => {
      return '<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button ' + (idx !== 0 ? 'collapsed' : '') + '" type="button" data-bs-toggle="collapse" data-bs-target="#curriculum' + idx + '"><strong>' + s.name + '</strong><span class="badge bg-secondary ms-2">' + s.topics.length + ' topics</span></button></h2><div id="curriculum' + idx + '" class="accordion-collapse collapse ' + (idx === 0 ? 'show' : '') + '" data-bs-parent="#curriculumAccordion"><div class="accordion-body p-0">' + (s.topics && s.topics.length > 0 ? '<div class="table-responsive"><table class="table table-sm mb-0"><thead class="table-light"><tr><th>Topic</th><th>Grade</th><th>Lessons</th><th>Assignments</th><th>Quizzes</th></tr></thead><tbody>' + s.topics.map(t => '<tr><td><strong>' + t.name + '</strong></td><td>' + (t.gradeLevel !== null ? t.gradeLevel : '-') + '</td><td>' + (t.lessons ? '<span class="badge bg-success">' + t.lessons.length + '</span>' : '0') + '</td><td>' + (t.assignments ? '<span class="badge bg-primary">' + t.assignments.length + '</span>' : '0') + '</td><td>' + (t.quizzes ? '<span class="badge bg-warning text-dark">' + t.quizzes.length + '</span>' : '0') + '</td></tr>').join('') + '</tbody></table></div>' : '<div class="p-3 text-muted">No topics in this subject</div>') + '</div></div></div>';
    }).join('') + '</div>' : '<div class="p-5 text-center text-muted"><i class="bi bi-inbox fs-1 d-block mb-3"></i><p>No subjects in this department</p></div>'}
  </div>
</div>

<!-- Recent Lessons -->
<div class="card mt-4">
  <div class="card-header">
    <h5 class="mb-0"><i class="bi bi-file-earmark-text me-2"></i>Recent Lessons</h5>
  </div>
  <div class="card-body p-0">
    <div class="list-group list-group-flush">
      ${(function() {
        let allLessons = [];
        if (subjects) {
          subjects.forEach(s => {
            if (s.topics) {
              s.topics.forEach(t => {
                if (t.lessons) {
                  t.lessons.forEach(l => {
                    allLessons.push({ ...l, topicName: t.name, subjectName: s.name });
                  });
                }
              });
            }
          });
        }
        allLessons.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());
        const recentLessons = allLessons.slice(0, 10);
        return recentLessons.length > 0
          ? recentLessons.map(l => '<div class="list-group-item"><div class="d-flex justify-content-between align-items-start"><div><strong>' + l.title + '</strong><br><small class="text-muted">' + l.subjectName + ' &raquo; ' + l.topicName + '</small><br><small class="text-muted">Created by: ' + (l.createdBy ? l.createdBy.firstName + ' ' + l.createdBy.lastName : 'Unknown') + '</small></div><small class="text-muted">' + new Date(l.createdAt).toLocaleDateString() + '</small></div></div>').join('')
          : '<div class="p-4 text-center text-muted"><i class="bi bi-inbox fs-1 d-block mb-2"></i>No lessons yet</div>';
      })()}
    </div>
  </div>
</div>
`, activePage: 'curriculum', pageTitle: 'Curriculum' }) %>
