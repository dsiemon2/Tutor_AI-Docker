<%- include('../layouts/district', { body: `
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h4 class="mb-1">Users</h4>
    <p class="text-muted mb-0">Manage all users across ${district?.name || 'your district'}</p>
  </div>
</div>

<!-- Filters -->
<div class="card mb-4">
  <div class="card-body">
    <form method="GET" class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label">Filter by Role</label>
        <select name="role" class="form-select">
          <option value="all" ${filters?.role === 'all' ? 'selected' : ''}>All Roles</option>
          <option value="PRINCIPAL" ${filters?.role === 'PRINCIPAL' ? 'selected' : ''}>Principal</option>
          <option value="VICE_PRINCIPAL" ${filters?.role === 'VICE_PRINCIPAL' ? 'selected' : ''}>Vice Principal</option>
          <option value="DEPARTMENT_HEAD" ${filters?.role === 'DEPARTMENT_HEAD' ? 'selected' : ''}>Department Head</option>
          <option value="TEACHER" ${filters?.role === 'TEACHER' ? 'selected' : ''}>Teacher</option>
          <option value="STUDENT" ${filters?.role === 'STUDENT' ? 'selected' : ''}>Student</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Filter by School</label>
        <select name="school" class="form-select">
          <option value="all" ${filters?.school === 'all' ? 'selected' : ''}>All Schools</option>
          ${schools ? schools.map(s => '<option value="' + s.id + '" ' + (filters?.school === s.id ? 'selected' : '') + '>' + s.name + '</option>').join('') : ''}
        </select>
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-primary w-100">
          <i class="bi bi-filter me-2"></i>Apply Filters
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Role Summary -->
<div class="row g-3 mb-4">
  ${roleCounts ? roleCounts.map(rc => '<div class="col-auto"><div class="badge bg-' + (rc.role === 'STUDENT' ? 'success' : rc.role === 'TEACHER' ? 'primary' : rc.role === 'PRINCIPAL' ? 'warning' : 'secondary') + ' bg-opacity-10 text-' + (rc.role === 'STUDENT' ? 'success' : rc.role === 'TEACHER' ? 'primary' : rc.role === 'PRINCIPAL' ? 'warning' : 'secondary') + ' px-3 py-2"><i class="bi bi-' + (rc.role === 'STUDENT' ? 'mortarboard' : rc.role === 'TEACHER' ? 'person-workspace' : 'person-badge') + ' me-2"></i>' + rc.role.replace('_', ' ') + ': ' + rc._count.role + '</div></div>').join('') : ''}
</div>

<!-- Users Table -->
<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>School</th>
            <th>Status</th>
            <th>Last Login</th>
          </tr>
        </thead>
        <tbody>
          ${users && users.length > 0 ? users.map(u => '<tr><td><strong>' + u.firstName + ' ' + u.lastName + '</strong></td><td><small class="text-muted">' + u.email + '</small></td><td><span class="badge bg-' + (u.role === 'STUDENT' ? 'success' : u.role === 'TEACHER' ? 'primary' : u.role === 'PRINCIPAL' ? 'warning' : u.role === 'VICE_PRINCIPAL' ? 'info' : 'secondary') + '">' + u.role.replace('_', ' ') + '</span></td><td>' + (u.school?.name || '-') + '</td><td><span class="badge bg-' + (u.isActive ? 'success' : 'danger') + '">' + (u.isActive ? 'Active' : 'Inactive') + '</span></td><td><small class="text-muted">' + (u.lastLoginAt ? new Date(u.lastLoginAt).toLocaleDateString() : 'Never') + '</small></td></tr>').join('') : '<tr><td colspan="6" class="text-center py-5 text-muted"><i class="bi bi-inbox fs-1 d-block mb-2"></i><p>No users found matching your criteria</p></td></tr>'}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Info Card -->
<div class="card mt-4 bg-light">
  <div class="card-body">
    <div class="d-flex align-items-center gap-3">
      <i class="bi bi-info-circle text-primary fs-4"></i>
      <div>
        <strong>Note:</strong> Showing up to 100 users. Use filters to narrow down results.
      </div>
    </div>
  </div>
</div>
`, activePage: 'users', pageTitle: 'Users' }) %>
