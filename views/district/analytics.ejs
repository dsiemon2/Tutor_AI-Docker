<%- include('../layouts/district', { body: `
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h4 class="mb-1">District Analytics</h4>
    <p class="text-muted mb-0">Overview of tutoring activity across ${district?.name || 'your district'}</p>
  </div>
</div>

<!-- Summary Stats -->
<div class="row g-4 mb-4">
  <div class="col-md-3">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Total Sessions</div>
          <div class="stat-value">${analytics?.totalSessions || 0}</div>
        </div>
        <div class="stat-icon bg-primary bg-opacity-10 text-primary">
          <i class="bi bi-chat-dots"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Last 30 Days</div>
          <div class="stat-value">${analytics?.recentSessions || 0}</div>
        </div>
        <div class="stat-icon bg-success bg-opacity-10 text-success">
          <i class="bi bi-calendar-check"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Avg Session (min)</div>
          <div class="stat-value">${Math.round(analytics?.averageSessionDuration || 0)}</div>
        </div>
        <div class="stat-icon bg-warning bg-opacity-10 text-warning">
          <i class="bi bi-clock"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="stat-label">Schools</div>
          <div class="stat-value">${schools?.length || 0}</div>
        </div>
        <div class="stat-icon bg-info bg-opacity-10 text-info">
          <i class="bi bi-building"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Top Subjects -->
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Top Subjects</h5>
      </div>
      <div class="card-body">
        ${analytics?.topSubjects && analytics.topSubjects.length > 0 ? '<div class="list-group list-group-flush">' + analytics.topSubjects.map((subject, index) => '<div class="list-group-item d-flex justify-content-between align-items-center px-0"><div class="d-flex align-items-center gap-3"><span class="badge bg-' + ['primary', 'success', 'warning', 'info', 'secondary'][index] + ' rounded-pill">' + (index + 1) + '</span><span>' + subject.name + '</span></div><strong>' + subject.count + ' sessions</strong></div>').join('') + '</div>' : '<div class="text-center py-4 text-muted"><i class="bi bi-inbox fs-1 d-block mb-2"></i><p>No session data available</p></div>'}
      </div>
    </div>
  </div>

  <!-- Schools Overview -->
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-building me-2"></i>Schools Overview</h5>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>School</th>
                <th class="text-center">Type</th>
                <th class="text-center">Status</th>
              </tr>
            </thead>
            <tbody>
              ${schools && schools.length > 0 ? schools.map(school => '<tr><td>' + school.name + '</td><td class="text-center"><span class="badge bg-secondary">' + (school.schoolType || 'School') + '</span></td><td class="text-center"><span class="badge bg-' + (school.isActive ? 'success' : 'danger') + '">' + (school.isActive ? 'Active' : 'Inactive') + '</span></td></tr>').join('') : '<tr><td colspan="3" class="text-center py-4 text-muted">No schools found</td></tr>'}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Analytics Info Card -->
<div class="card mt-4">
  <div class="card-body">
    <div class="d-flex align-items-center gap-3">
      <div class="rounded bg-info bg-opacity-10 p-3">
        <i class="bi bi-lightbulb text-info fs-4"></i>
      </div>
      <div>
        <h6 class="mb-1">Analytics Insights</h6>
        <p class="text-muted mb-0">Track student engagement, identify trending subjects, and monitor tutoring activity across all schools in your district. Use these insights to improve educational outcomes and resource allocation.</p>
      </div>
    </div>
  </div>
</div>
`, activePage: 'analytics', pageTitle: 'Analytics' }) %>
