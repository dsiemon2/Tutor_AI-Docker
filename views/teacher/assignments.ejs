<%- include('../layouts/teacher', { body: `
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h4 class="mb-1"><i class="bi bi-clipboard-check me-2"></i>Assignments</h4>
    <p class="text-muted mb-0">Create and manage assignments for your students</p>
  </div>
  <a href="${typeof basePath !== 'undefined' ? basePath : ''}/teacher/assignments/create" class="btn btn-primary">
    <i class="bi bi-plus-lg me-2"></i>Create Assignment
  </a>
</div>

<!-- Assignments Table -->
${assignments && assignments.length > 0 ? '<div class="card"><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover mb-0"><thead class="table-light"><tr><th>Assignment</th><th>Topic</th><th>Assigned To</th><th>Due Date</th><th>Submissions</th><th>Status</th><th></th></tr></thead><tbody>' + assignments.map(a => {
  const submitted = a.submissions?.length || 0;
  const expected = a.studentId ? 1 : (a.class?.students?.length || 0);
  const graded = a.submissions?.filter(s => s.status === 'graded').length || 0;
  const isOverdue = a.dueDate && new Date(a.dueDate) < new Date();
  return '<tr><td><a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/teacher/assignments/' + a.id + '" class="text-decoration-none"><strong>' + a.title + '</strong></a><br><small class="text-muted">' + a.type + ' &bull; ' + a.maxPoints + ' pts</small></td><td>' + (a.topic?.subject?.name || '-') + '<br><small class="text-muted">' + (a.topic?.name || '-') + '</small></td><td>' + (a.studentId ? '<span class="badge bg-info">' + (a.student?.firstName + ' ' + a.student?.lastName) + '</span>' : (a.class ? '<span class="badge bg-primary">' + a.class.name + '</span>' : '<span class="badge bg-secondary">None</span>')) + '</td><td>' + (a.dueDate ? '<span class="' + (isOverdue ? 'text-danger' : '') + '">' + new Date(a.dueDate).toLocaleDateString() + '</span>' : '<span class="text-muted">No due date</span>') + '</td><td><div class="d-flex align-items-center gap-2"><div class="progress flex-grow-1" style="width: 60px; height: 6px;"><div class="progress-bar ' + (submitted === expected ? 'bg-success' : 'bg-warning') + '" style="width: ' + (expected > 0 ? (submitted/expected)*100 : 0) + '%"></div></div><small>' + submitted + '/' + expected + '</small></div></td><td>' + (graded === submitted && submitted > 0 ? '<span class="badge bg-success">Graded</span>' : (submitted > 0 ? '<span class="badge bg-warning text-dark">Pending</span>' : '<span class="badge bg-secondary">No submissions</span>')) + '</td><td><a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/teacher/assignments/' + a.id + '" class="btn btn-sm btn-outline-primary">View</a></td></tr>';
}).join('') + '</tbody></table></div></div></div>' : '<div class="text-center py-5"><div class="mb-4"><i class="bi bi-clipboard-check fs-1 text-muted"></i></div><h5>No Assignments Yet</h5><p class="text-muted mb-4">Create your first assignment to track student work.</p><a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/teacher/assignments/create" class="btn btn-primary"><i class="bi bi-plus-lg me-2"></i>Create Your First Assignment</a></div>'}
`, activePage: 'assignments', pageTitle: 'Assignments' }) %>
