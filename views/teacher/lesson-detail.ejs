<%- include('../layouts/teacher', { body: `
<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-4">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="${typeof basePath !== 'undefined' ? basePath : ''}/teacher/lessons">Lessons</a></li>
    <li class="breadcrumb-item active">${lesson.title}</li>
  </ol>
</nav>

<!-- Lesson Header -->
<div class="card mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start">
      <div>
        <h4 class="mb-2">${lesson.title}</h4>
        <p class="text-muted mb-3">${lesson.description || 'No description'}</p>
        <div class="d-flex gap-2 flex-wrap">
          <span class="badge bg-primary"><i class="bi bi-book me-1"></i>${lesson.topic?.subject?.name || 'No subject'}</span>
          <span class="badge bg-secondary"><i class="bi bi-bookmark me-1"></i>${lesson.topic?.name || 'No topic'}</span>
          ${lesson.gradeLevel !== null ? '<span class="badge bg-info">Grade ' + lesson.gradeLevel + '</span>' : ''}
          ${lesson.duration ? '<span class="badge bg-warning text-dark"><i class="bi bi-clock me-1"></i>' + lesson.duration + ' min</span>' : ''}
          ${lesson.class ? '<span class="badge bg-success">' + lesson.class.name + '</span>' : '<span class="badge bg-light text-dark">All Classes</span>'}
        </div>
      </div>
      <div class="d-flex gap-2">
        <a href="${typeof basePath !== 'undefined' ? basePath : ''}/teacher/lessons/${lesson.id}/edit" class="btn btn-outline-primary">
          <i class="bi bi-pencil me-2"></i>Edit
        </a>
        <a href="${typeof basePath !== 'undefined' ? basePath : ''}/teacher/assignments/create?lessonId=${lesson.id}" class="btn btn-primary">
          <i class="bi bi-plus-lg me-2"></i>Create Assignment
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Lesson Content -->
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header bg-white">
        <h5 class="mb-0"><i class="bi bi-file-text me-2"></i>Lesson Content</h5>
      </div>
      <div class="card-body">
        <div class="lesson-content" style="white-space: pre-wrap; line-height: 1.8;">${lesson.content}</div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="col-lg-4">
    <!-- Assignments Card -->
    <div class="card mb-4">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h6 class="mb-0"><i class="bi bi-clipboard-check me-2"></i>Assignments</h6>
        <span class="badge bg-primary">${lesson.assignments?.length || 0}</span>
      </div>
      <div class="card-body p-0">
        ${lesson.assignments && lesson.assignments.length > 0 ? '<div class="list-group list-group-flush">' + lesson.assignments.map(a => '<a href="' + (typeof basePath !== 'undefined' ? basePath : '') + '/teacher/assignments/' + a.id + '" class="list-group-item list-group-item-action"><div class="d-flex justify-content-between align-items-center"><div><strong>' + a.title + '</strong><br><small class="text-muted">' + (a.dueDate ? 'Due: ' + new Date(a.dueDate).toLocaleDateString() : 'No due date') + '</small></div><span class="badge bg-secondary">' + (a.submissions?.length || 0) + ' submissions</span></div></a>').join('') + '</div>' : '<div class="p-4 text-center text-muted"><i class="bi bi-clipboard fs-3 d-block mb-2"></i><small>No assignments yet</small></div>'}
      </div>
      <div class="card-footer bg-white">
        <a href="${typeof basePath !== 'undefined' ? basePath : ''}/teacher/assignments/create?lessonId=${lesson.id}" class="btn btn-sm btn-outline-primary w-100">
          <i class="bi bi-plus-lg me-2"></i>Add Assignment
        </a>
      </div>
    </div>

    <!-- Info Card -->
    <div class="card">
      <div class="card-header bg-white">
        <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Lesson Info</h6>
      </div>
      <div class="card-body">
        <table class="table table-sm mb-0">
          <tr>
            <td class="text-muted">Created</td>
            <td>${new Date(lesson.createdAt).toLocaleDateString()}</td>
          </tr>
          <tr>
            <td class="text-muted">Updated</td>
            <td>${new Date(lesson.updatedAt).toLocaleDateString()}</td>
          </tr>
          <tr>
            <td class="text-muted">Category</td>
            <td>${lesson.topic?.subject?.category?.name || 'N/A'}</td>
          </tr>
          <tr>
            <td class="text-muted">Subject</td>
            <td>${lesson.topic?.subject?.name || 'N/A'}</td>
          </tr>
          <tr>
            <td class="text-muted">Topic</td>
            <td>${lesson.topic?.name || 'N/A'}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Delete Button -->
<div class="mt-4">
  <form action="${typeof basePath !== 'undefined' ? basePath : ''}/teacher/lessons/${lesson.id}/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this lesson? This cannot be undone.');">
    <button type="submit" class="btn btn-outline-danger btn-sm">
      <i class="bi bi-trash me-2"></i>Delete Lesson
    </button>
  </form>
</div>
`, activePage: 'lessons', pageTitle: lesson.title }) %>
